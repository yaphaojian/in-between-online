<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>In-Between ¬∑ Ë¥¢Á•ûÊù•‰∫Ü</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700;900&family=Fredoka:wght@600;700&family=Outfit:wght@700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --lacquer:    #130800;
  --lacquer2:   #1c0f00;
  --lacquer3:   #261500;
  --red:        #cc1a00;
  --red-bright: #ff3300;
  --red-deep:   #8b1000;
  --gold:       #f0b000;
  --gold-light: #ffe566;
  --gold-bright:#ffd700;
  --gold-dark:  #8a6200;
  --gold-dim:   #6b4e00;
  --cream:      #fff8e8;
  --card-bg:    #fffdf5;
  --red-suit:   #cc0000;
  --black-suit: #1a0a00;
}
body {
  font-family: 'Outfit', sans-serif;
  background: #060300;
  min-height: 100vh;
  display: flex; flex-direction: column; align-items: center;
  padding: 28px 20px 80px; gap: 12px;
  overscroll-behavior: none;
}
.page-title { font-family:'Fredoka',sans-serif; font-size:11px; letter-spacing:0.3em; text-transform:uppercase; color:rgba(240,176,0,0.35); }
.demo-controls { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; }
.demo-btn { padding:5px 12px; border-radius:6px; border:1px solid rgba(240,176,0,0.2); background:rgba(240,176,0,0.06); font-family:'Outfit',sans-serif; font-size:11px; font-weight:700; color:rgba(240,176,0,0.4); cursor:pointer; transition:all 0.15s; }
.demo-btn:hover { background:rgba(240,176,0,0.14); color:rgba(240,176,0,0.8); }
.demo-btn.sel   { background:rgba(240,176,0,0.2); border-color:var(--gold); color:var(--gold-bright); }
.reset-btn-outer { background:rgba(240,176,0,0.07); border:1px dashed rgba(240,176,0,0.2); border-radius:8px; padding:5px 16px; font-family:'Outfit',sans-serif; font-size:11px; font-weight:700; color:rgba(240,176,0,0.35); cursor:pointer; transition:all 0.2s; }
.reset-btn-outer:hover { color:rgba(240,176,0,0.7); background:rgba(240,176,0,0.14); }

/* Screen wrapper ‚Äî overflow visible so arcing card escapes */
.screen { width:390px; border-radius:20px; overflow:visible; position:relative; box-shadow:0 0 0 2px var(--gold-dark),0 0 0 4px var(--lacquer3),0 0 0 6px rgba(240,176,0,0.3),0 32px 80px rgba(0,0,0,0.9); }

/* game-bg clips decoration but not absolutely-positioned children we'll teleport */
.game-bg { background:radial-gradient(ellipse at 50% 0%,#2a1000 0%,var(--lacquer) 50%),#0a0600; min-height:800px; border-radius:20px; display:flex; flex-direction:column; position:relative; overflow:hidden; }

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes bob        { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
@keyframes shimmer    { 0%{left:-100%} 100%{left:200%} }
@keyframes blink      { 0%,100%{opacity:1} 50%{opacity:0.2} }
@keyframes twinkle    { 0%,100%{opacity:0;transform:scale(0) rotate(0deg)} 50%{opacity:1;transform:scale(1) rotate(180deg)} }
@keyframes float-coin { 0%,100%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(-12px) rotate(20deg)} }
@keyframes number-glow { 0%,100%{text-shadow:0 0 10px var(--gold),0 0 20px rgba(240,176,0,0.4)} 50%{text-shadow:0 0 20px var(--gold-bright),0 0 40px rgba(255,213,0,0.7)} }
@keyframes slide-up   { 0%{transform:translateY(110%);opacity:0} 100%{transform:translateY(0);opacity:1} }
@keyframes flash-gold { 0%{opacity:0} 18%{opacity:0.45} 100%{opacity:0} }
@keyframes flash-red  { 0%{opacity:0} 18%{opacity:0.35} 100%{opacity:0} }
@keyframes net-ripple { 0%,100%{opacity:0.18} 35%{opacity:0.8} 65%{opacity:0.3} }
@keyframes whoosh-fade{ 0%{opacity:0.8} 100%{opacity:0} }
@keyframes hint-bounce{ 0%,100%{transform:translateX(-50%) translateY(0);opacity:0.5} 50%{transform:translateX(-50%) translateY(-8px);opacity:1} }
@keyframes stamp-in   { 0%{transform:translate(-50%,-50%) scale(2.4) rotate(-6deg);opacity:0} 55%{transform:translate(-50%,-50%) scale(0.93) rotate(2deg);opacity:1} 75%{transform:translate(-50%,-50%) scale(1.06) rotate(-1deg)} 100%{transform:translate(-50%,-50%) scale(1) rotate(-3deg);opacity:1} }
@keyframes pulse-ring { 0%{transform:translate(-50%,-50%) scale(0.6);opacity:1} 100%{transform:translate(-50%,-50%) scale(2.8);opacity:0} }
@keyframes coin-burst { 0%{transform:translate(0,0) scale(1);opacity:1} 100%{transform:translate(var(--cx),var(--cy)) scale(0.1);opacity:0} }
@keyframes confetti-fall { 0%{transform:translateY(-10px) rotate(0deg);opacity:1} 100%{transform:translateY(220px) rotate(540deg);opacity:0} }
@keyframes post-rattle { 0%,100%{transform:rotate(var(--br,0deg))} 20%{transform:rotate(calc(var(--br,0deg) + 5deg))} 40%{transform:rotate(calc(var(--br,0deg) - 5deg))} 60%{transform:rotate(calc(var(--br,0deg) + 2deg))} }
@keyframes post-jolt-l { 0%,100%{transform:rotate(-8deg)} 25%{transform:rotate(-18deg) translateX(-10px)} 55%{transform:rotate(-3deg) translateX(5px)} }
@keyframes post-jolt-r { 0%,100%{transform:rotate(8deg)} 25%{transform:rotate(18deg) translateX(10px)} 55%{transform:rotate(3deg) translateX(-5px)} }

.flash-overlay { position:absolute; inset:0; z-index:50; pointer-events:none; opacity:0; }
.flash-overlay.win  { background:radial-gradient(ellipse at 50% 45%,rgba(255,213,0,0.55),transparent 65%); }
.flash-overlay.lose { background:radial-gradient(ellipse at 50% 45%,rgba(200,0,0,0.45),transparent 65%); }
.flash-overlay.post { background:radial-gradient(ellipse at 50% 45%,rgba(255,140,0,0.4),transparent 65%); }

.gold-frame { position:absolute; inset:0; pointer-events:none; z-index:100; border:3px solid transparent; border-image:linear-gradient(135deg,var(--gold-dark) 0%,var(--gold-bright) 25%,var(--gold-dark) 50%,var(--gold-bright) 75%,var(--gold-dark) 100%) 1; }
.sparkle { position:absolute; pointer-events:none; font-size:var(--sz,14px); color:var(--gold-bright); animation:twinkle var(--dur,2s) ease-in-out infinite var(--del,0s); z-index:1; }

/* Header */
.top-header { background:linear-gradient(180deg,#1e0d00 0%,#140800 100%); border-bottom:2px solid var(--gold-dark); padding:14px 16px 10px; position:relative; z-index:2; }
.ornament-rule { display:flex; align-items:center; gap:8px; margin-bottom:10px; }
.orn-line { flex:1; height:1px; background:linear-gradient(90deg,transparent,var(--gold-dark),var(--gold),var(--gold-dark),transparent); }
.orn-diamond { width:7px; height:7px; background:var(--gold-bright); transform:rotate(45deg); box-shadow:0 0 6px var(--gold); flex-shrink:0; }
.orn-text { font-family:'Noto Serif SC',serif; font-size:11px; color:var(--gold); letter-spacing:0.15em; }
.header-row { display:flex; align-items:center; justify-content:space-between; }
.game-wordmark { font-family:'Noto Serif SC',serif; font-size:16px; font-weight:900; color:var(--gold-bright); text-shadow:0 0 12px rgba(255,215,0,0.6),0 2px 4px rgba(0,0,0,0.8); }
.room-btn { display:flex; align-items:center; gap:6px; background:linear-gradient(135deg,#1a0c00,#2a1800); border:1.5px solid var(--gold-dark); border-radius:8px; padding:6px 12px; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.5); }
.room-icon { font-size:13px; }
.room-info { display:flex; flex-direction:column; line-height:1.2; }
.room-label { font-size:8px; font-weight:800; letter-spacing:0.15em; text-transform:uppercase; color:var(--gold-dim); }
.room-num   { font-family:'Fredoka',sans-serif; font-size:14px; color:var(--gold-bright); }
.player-row { display:flex; gap:6px; margin-top:10px; }
.player-slot { flex:1; display:flex; align-items:center; gap:6px; background:linear-gradient(135deg,#120700,#1e0f00); border:1.5px solid rgba(240,176,0,0.15); border-radius:8px; padding:6px 8px; }
.player-slot.active { border-color:var(--gold); background:linear-gradient(135deg,#1e0d00,#301800); box-shadow:0 0 10px rgba(240,176,0,0.15); }
.p-avatar { width:26px; height:26px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-family:'Fredoka',sans-serif; font-size:12px; font-weight:700; flex-shrink:0; border:1.5px solid rgba(240,176,0,0.3); }
.p-avatar.a1{background:linear-gradient(135deg,#cc1a00,#ff3300);color:#fff}
.p-avatar.a2{background:linear-gradient(135deg,#7c3aed,#a78bfa);color:#fff}
.p-avatar.a3{background:linear-gradient(135deg,#059669,#34d399);color:#fff}
.p-info { display:flex; flex-direction:column; min-width:0; }
.p-name { font-size:11px; font-weight:800; color:var(--cream); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.p-status { font-size:9px; font-weight:700; color:rgba(240,176,0,0.4); }
.player-slot.active .p-status { color:var(--gold); }
.live-dot { width:6px; height:6px; border-radius:50%; background:var(--gold-bright); box-shadow:0 0 8px var(--gold-bright); animation:blink 1.2s infinite; margin-left:auto; flex-shrink:0; }
.round-pips { display:flex; gap:5px; justify-content:center; margin-top:8px; }
.pip    { width:26px; height:4px; border-radius:2px; background:rgba(240,176,0,0.12); }
.pip.on { background:var(--gold); box-shadow:0 0 6px rgba(240,176,0,0.5); }

/* Arena */
.arena { flex:1; display:flex; flex-direction:column; align-items:center; padding:14px 16px 0; position:relative; z-index:1; }
.round-tag { font-size:10px; font-weight:800; letter-spacing:0.2em; text-transform:uppercase; color:rgba(240,176,0,0.4); margin-bottom:8px; }

/* Goalpost scene ‚Äî overflow visible so card arcs out */
.goalpost-scene { width:100%; position:relative; height:296px; overflow:visible; }
.crossbar-svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:2; }
.net-rippling .net-line { animation:net-ripple 0.65s ease-in-out; }
.post-left  { position:absolute; bottom:0; left:10px; transform-origin:bottom center; transform:rotate(-8deg); z-index:3; }
.post-right { position:absolute; bottom:0; right:10px; transform-origin:bottom center; transform:rotate(8deg); z-index:3; }
.post-left.rattling  { animation:post-rattle 0.5s ease-in-out; --br:-8deg; }
.post-right.rattling { animation:post-rattle 0.5s ease-in-out; --br:8deg; }
.post-left.jolting   { animation:post-jolt-l 0.42s ease-in-out; }
.post-right.jolting  { animation:post-jolt-r 0.42s ease-in-out; }

/* The ball wrap ‚Äî this IS the draggable */
.ball-wrap {
  position:absolute; bottom:12px; left:50%;
  transform:translateX(-50%);
  z-index:10;
  display:flex; flex-direction:column; align-items:center; gap:4px;
  touch-action:none;
  cursor:grab;
  user-select:none;
}
.ball-wrap:active { cursor:grabbing; }

/* Hint arrow above the card */
.ball-hint {
  position:absolute; bottom:calc(100% + 6px); left:50%;
  transform:translateX(-50%);
  display:flex; flex-direction:column; align-items:center; gap:2px;
  pointer-events:none; transition:opacity 0.25s;
}
.ball-hint-arrow { font-size:18px; color:var(--gold); text-shadow:0 0 10px rgba(240,176,0,0.7); animation:hint-bounce 1.3s ease-in-out infinite; }
.ball-hint-text { font-size:9px; font-weight:800; letter-spacing:0.12em; text-transform:uppercase; color:rgba(240,176,0,0.45); white-space:nowrap; }

/* Direction label shown while dragging */
.drag-dir-label {
  position:absolute; bottom:calc(100% + 28px); left:50%; transform:translateX(-50%);
  font-family:'Noto Serif SC',serif; font-size:12px; font-weight:900;
  white-space:nowrap; opacity:0; pointer-events:none;
  text-shadow:0 0 10px currentColor; transition:opacity 0.1s;
}
.drag-dir-label.show { opacity:1; }
.drag-dir-label.d-up    { color:#00e050; }
.drag-dir-label.d-left  { color:var(--red-bright); }
.drag-dir-label.d-right { color:var(--red-bright); }
.drag-dir-label.d-post  { color:var(--gold-bright); }

.whoosh-trail { position:absolute; left:50%; bottom:75px; width:48px; height:105px; pointer-events:none; z-index:8; background:linear-gradient(180deg,rgba(255,215,0,0) 0%,rgba(255,215,0,0.55) 55%,rgba(255,215,0,0) 100%); border-radius:24px; opacity:0; }
.whoosh-trail.show { animation:whoosh-fade 0.55s ease-out forwards; }

/* Cards */
.card { border-radius:12px; display:flex; flex-direction:column; justify-content:space-between; padding:9px; position:relative; flex-shrink:0; background:var(--card-bg); }
.card.post-card { width:114px; height:160px; border:2px solid rgba(0,0,0,0.08); box-shadow:0 0 0 2px rgba(255,255,255,0.9),0 0 0 4px var(--gold-dark),0 0 0 6px rgba(240,176,0,0.2),0 10px 30px rgba(0,0,0,0.7); }
.card.ball-card { width:102px; height:143px; border:2px solid rgba(0,0,0,0.08); box-shadow:0 0 0 2px rgba(255,255,255,0.95),0 0 0 4px var(--gold),0 0 0 7px rgba(240,176,0,0.3),0 12px 36px rgba(0,0,0,0.7),0 0 20px rgba(255,215,0,0.2); animation:bob 2.4s ease-in-out infinite; }
.card.ball-card.no-bob { animation:none !important; }
.card.red-suit   { color:var(--red-suit); }
.card.black-suit { color:var(--black-suit); }
.card-corner { display:flex; flex-direction:column; line-height:1; }
.card-corner.flip { transform:rotate(180deg); align-self:flex-end; }
.card-rank    { font-family:'Fredoka',sans-serif; font-size:22px; line-height:1; }
.card-suit-sm { font-size:15px; line-height:1.1; }
.card-center-suit { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:36px; opacity:0.1; line-height:1; }
.card.face-down { background:linear-gradient(145deg,#1e0d00 0%,#2e1500 100%); border:2px solid var(--gold-dark); box-shadow:0 0 0 2px var(--lacquer),0 0 0 4px var(--gold-dark),0 0 0 6px rgba(240,176,0,0.2),0 12px 36px rgba(0,0,0,0.8); animation:bob 2.4s ease-in-out infinite; }
.card.face-down::before { content:''; position:absolute; inset:8px; border:1.5px solid rgba(240,176,0,0.15); border-radius:6px; background-image:repeating-linear-gradient(45deg,transparent,transparent 5px,rgba(240,176,0,0.04) 5px,rgba(240,176,0,0.04) 6px); }
.q-mark { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-family:'Noto Serif SC',serif; font-size:38px; font-weight:900; color:rgba(240,176,0,0.25); }

.result-stamp { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) rotate(-3deg); font-family:'Noto Serif SC',serif; font-size:12px; font-weight:900; letter-spacing:0.05em; padding:4px 10px; border-radius:6px; border:2.5px solid; white-space:nowrap; z-index:20; display:none; animation:stamp-in 0.45s cubic-bezier(0.22,1,0.36,1) forwards; }
.stamp-win  { color:#00a830; border-color:#00a830; background:rgba(10,6,0,0.92); }
.stamp-miss { color:var(--red-bright); border-color:var(--red-bright); background:rgba(10,6,0,0.92); }
.stamp-post { color:var(--gold-bright); border-color:var(--gold-bright); background:rgba(10,6,0,0.92); }
.pulse-ring { position:absolute; top:50%; left:50%; width:88px; height:88px; border-radius:50%; border:2.5px solid; pointer-events:none; z-index:5; animation:pulse-ring 0.8s ease-out forwards; }
.ring-win  { border-color:#00e050; }
.ring-lose { border-color:var(--red-bright); }
.ring-post { border-color:var(--gold-bright); }
.coin-particle { position:absolute; font-size:16px; pointer-events:none; z-index:30; top:50%; left:50%; animation:coin-burst 1s ease-out forwards; }
.confetti-piece { position:absolute; width:7px; height:7px; border-radius:2px; pointer-events:none; z-index:30; animation:confetti-fall 1s ease-in forwards; }

/* Pot */
.pot-area { width:100%; margin:12px 0 0; background:linear-gradient(135deg,#1a0c00,#120800); border:2px solid var(--gold-dark); border-radius:14px; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; box-shadow:inset 0 1px 0 rgba(240,176,0,0.1),0 4px 16px rgba(0,0,0,0.5); position:relative; overflow:hidden; }
.pot-area::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,var(--gold),transparent); }
.pot-left { display:flex; flex-direction:column; gap:1px; }
.pot-lbl  { font-size:9px; font-weight:800; letter-spacing:0.25em; text-transform:uppercase; color:rgba(240,176,0,0.4); }
.pot-value{ display:flex; align-items:baseline; gap:3px; }
.pot-cur  { font-size:15px; font-weight:800; color:var(--gold); }
.pot-num  { font-family:'Fredoka',sans-serif; font-size:38px; color:var(--gold-bright); line-height:1; animation:number-glow 2.5s ease-in-out infinite; }
.pot-sub  { font-size:9px; font-weight:700; color:rgba(240,176,0,0.3); }
.coin-stack { display:flex; flex-direction:column; align-items:center; }
.coin-top { width:44px; height:22px; border-radius:50%; background:radial-gradient(ellipse at 40% 35%,#ffe566,#f0b000); border:1.5px solid rgba(0,0,0,0.25); display:flex; align-items:center; justify-content:center; font-size:14px; box-shadow:0 0 10px rgba(240,176,0,0.4); animation:float-coin 2.8s ease-in-out infinite; }
.coin-disc { width:44px; height:12px; border-radius:50%; border:1.5px solid rgba(0,0,0,0.3); margin-top:-4px; box-shadow:0 2px 4px rgba(0,0,0,0.4); }
.coin-disc.c1{background:linear-gradient(180deg,#ffe566,#f0b000);height:14px}
.coin-disc.c2{background:linear-gradient(180deg,#ffd700,#c88000)}
.coin-disc.c3{background:linear-gradient(180deg,#e0a000,#a86000)}
.coin-disc.c4{background:linear-gradient(180deg,#c09000,#8a5000)}
.coin-disc.c5{background:linear-gradient(180deg,#a07800,#704000)}

/* Deal section */
.deal-section { width:100%; padding:8px 16px 22px; display:flex; flex-direction:column; align-items:center; gap:4px; }
.deal-hint-txt { font-size:9px; font-weight:800; letter-spacing:0.12em; text-transform:uppercase; color:rgba(240,176,0,0.22); }
.deal-tap-btn { background:rgba(240,176,0,0.06); border:1px dashed rgba(240,176,0,0.18); border-radius:8px; padding:5px 14px; font-family:'Outfit',sans-serif; font-size:10px; font-weight:700; color:rgba(240,176,0,0.3); cursor:pointer; transition:all 0.2s; }
.deal-tap-btn:hover   { color:rgba(240,176,0,0.6); background:rgba(240,176,0,0.12); }
.deal-tap-btn:disabled{ opacity:0.15; cursor:not-allowed; }

/* Result banner */
.result-banner { position:absolute; bottom:0; left:0; right:0; z-index:40; display:none; animation:slide-up 0.42s cubic-bezier(0.22,1,0.36,1) forwards; border-radius:0 0 20px 20px; overflow:hidden; }
.result-banner.b-win  { background:linear-gradient(160deg,#001a08 0%,#002810 100%); border-top:2px solid #00a830; }
.result-banner.b-miss { background:linear-gradient(160deg,#1a0000 0%,#280000 100%); border-top:2px solid var(--red-bright); }
.result-banner.b-post { background:linear-gradient(160deg,#1a0e00 0%,#281600 100%); border-top:2px solid var(--gold); }
.banner-inner { padding:16px 20px 10px; display:flex; align-items:center; justify-content:space-between; }
.banner-left  { display:flex; flex-direction:column; gap:3px; }
.banner-emoji { font-size:28px; line-height:1; }
.banner-title { font-family:'Noto Serif SC',serif; font-size:20px; font-weight:900; letter-spacing:0.04em; }
.b-win  .banner-title { color:#00e050; text-shadow:0 0 14px rgba(0,200,80,0.6); }
.b-miss .banner-title { color:var(--red-bright); text-shadow:0 0 14px rgba(255,51,0,0.6); }
.b-post .banner-title { color:var(--gold-bright); text-shadow:0 0 14px rgba(255,215,0,0.6); }
.banner-sub { font-size:11px; font-weight:700; color:rgba(255,248,232,0.55); }
.banner-right { text-align:right; }
.banner-amt-lbl { font-size:8px; font-weight:800; letter-spacing:0.2em; text-transform:uppercase; color:rgba(240,176,0,0.4); }
.banner-amt-val { font-family:'Fredoka',sans-serif; font-size:32px; line-height:1; animation:number-glow 1.5s ease-in-out infinite; }
.b-win  .banner-amt-val { color:#00e050; }
.b-miss .banner-amt-val,.b-post .banner-amt-val { color:var(--red-bright); }
.next-btn { width:calc(100% - 40px); margin:0 20px 20px; height:48px; background:linear-gradient(180deg,#2e1800 0%,#1e1000 100%); border:2px solid var(--gold-dark); border-radius:10px; font-family:'Noto Serif SC',serif; font-size:15px; font-weight:900; color:var(--gold); cursor:pointer; letter-spacing:0.06em; display:flex; align-items:center; justify-content:center; gap:8px; transition:border-color 0.2s,background 0.2s; box-shadow:inset 0 1px 0 rgba(240,176,0,0.1),0 3px 10px rgba(0,0,0,0.4); text-shadow:0 0 8px rgba(240,176,0,0.4); }
.next-btn:hover { border-color:var(--gold-bright); background:linear-gradient(180deg,#3e2200,#2a1600); }
</style>
</head>
<body>

<div class="page-title">Ë¥¢Á•ûÊù•‰∫Ü ¬∑ In-Between</div>
<div class="demo-controls">
  <button class="demo-btn" id="btn-goal"   onclick="setMode('goal')">ü•Ö GOAL</button>
  <button class="demo-btn" id="btn-miss-l" onclick="setMode('miss-l')">‚óÄ TOO LOW</button>
  <button class="demo-btn" id="btn-miss-r" onclick="setMode('miss-r')">TOO HIGH ‚ñ∂</button>
  <button class="demo-btn" id="btn-post-l" onclick="setMode('post-l')">üèπ POST 4</button>
  <button class="demo-btn" id="btn-post-r" onclick="setMode('post-r')">üèπ POST J</button>
</div>
<button class="reset-btn-outer" onclick="resetGame()">‚Ü∫ Reset</button>

<div class="screen" id="screenEl">
<div class="game-bg" id="gameBg">
  <div class="gold-frame"></div>
  <div class="flash-overlay" id="flashOverlay"></div>
  <div class="sparkle" style="top:48px;left:18px;--sz:10px;--dur:2.2s;--del:0s;">‚ú¶</div>
  <div class="sparkle" style="top:62px;right:22px;--sz:8px;--dur:1.8s;--del:0.4s;">‚ú¶</div>
  <div class="sparkle" style="top:200px;left:14px;--sz:12px;--dur:2.5s;--del:0.8s;">‚ú¶</div>
  <div class="sparkle" style="top:240px;right:16px;--sz:9px;--dur:2s;--del:0.3s;">‚òÖ</div>
  <div class="sparkle" style="bottom:220px;left:10px;--sz:10px;--dur:2.8s;--del:1.1s;">‚ú¶</div>
  <div class="sparkle" style="bottom:180px;right:12px;--sz:8px;--dur:2.1s;--del:0.6s;">‚òÖ</div>

  <div class="top-header">
    <div class="ornament-rule">
      <div class="orn-line"></div><div class="orn-diamond"></div>
      <div class="orn-text">Ë¥¢Á•ûÊù•‰∫Ü</div>
      <div class="orn-diamond"></div><div class="orn-line"></div>
    </div>
    <div class="header-row">
      <div class="game-wordmark">IN BETWEEN</div>
      <div class="room-btn"><span class="room-icon">üèÆ</span><div class="room-info"><span class="room-label">Room ¬∑ copy</span><span class="room-num">#8F2K</span></div></div>
    </div>
    <div class="player-row">
      <div class="player-slot active">
        <div class="p-avatar a1">M</div>
        <div class="p-info"><span class="p-name">Marcus</span><span class="p-status">üéØ ‰Ω†ÁöÑÂõûÂêà!</span></div>
        <div class="live-dot"></div>
      </div>
      <div class="player-slot">
        <div class="p-avatar a2">J</div>
        <div class="p-info"><span class="p-name">Jenny</span><span class="p-status">Á≠âÂæÖ‰∏≠‚Ä¶</span></div>
      </div>
      <div class="player-slot">
        <div class="p-avatar a3">K</div>
        <div class="p-info"><span class="p-name">Kevin</span><span class="p-status">Á≠âÂæÖ‰∏≠‚Ä¶</span></div>
      </div>
    </div>
    <div class="round-pips">
      <div class="pip on"></div><div class="pip on"></div><div class="pip on"></div><div class="pip"></div><div class="pip"></div>
    </div>
  </div>

  <div class="arena">
    <div class="round-tag">Á¨¨ 3 ÂõûÂêà ¬∑ ÂÖ± 5 ÂõûÂêà</div>
    <div class="goalpost-scene" id="goalposts">
      <svg class="crossbar-svg" id="crossbarSvg" viewBox="0 0 350 296" preserveAspectRatio="none">
        <defs>
          <linearGradient id="barGrad" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%"  stop-color="#8a6200"/>
            <stop offset="25%" stop-color="#ffd700"/>
            <stop offset="50%" stop-color="#ffe566"/>
            <stop offset="75%" stop-color="#ffd700"/>
            <stop offset="100%" stop-color="#8a6200"/>
          </linearGradient>
          <filter id="goldGlow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
        </defs>
        <line class="net-line" x1="68" y1="76"  x2="282" y2="76"  stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="68" y1="104" x2="282" y2="104" stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="68" y1="132" x2="282" y2="132" stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="68" y1="160" x2="282" y2="160" stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="68" y1="188" x2="282" y2="188" stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="68" y1="216" x2="282" y2="216" stroke="rgba(240,176,0,0.12)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="108" y1="50" x2="108" y2="296" stroke="rgba(240,176,0,0.08)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="144" y1="50" x2="144" y2="296" stroke="rgba(240,176,0,0.08)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="175" y1="50" x2="175" y2="296" stroke="rgba(240,176,0,0.08)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="206" y1="50" x2="206" y2="296" stroke="rgba(240,176,0,0.08)" stroke-width="1" stroke-dasharray="5 8"/>
        <line class="net-line" x1="242" y1="50" x2="242" y2="296" stroke="rgba(240,176,0,0.08)" stroke-width="1" stroke-dasharray="5 8"/>
        <g filter="url(#goldGlow)">
          <line x1="68"  y1="90" x2="68"  y2="50" stroke="url(#barGrad)" stroke-width="7" stroke-linecap="round"/>
          <line x1="282" y1="90" x2="282" y2="50" stroke="url(#barGrad)" stroke-width="7" stroke-linecap="round"/>
          <line x1="60"  y1="50" x2="290" y2="50" stroke="url(#barGrad)" stroke-width="8" stroke-linecap="round"/>
          <circle cx="60"  cy="50" r="6" fill="#ffe566"/>
          <circle cx="290" cy="50" r="6" fill="#ffe566"/>
        </g>
      </svg>

      <div class="whoosh-trail" id="whooshTrail"></div>

      <div class="post-left" id="postLeft">
        <div class="card post-card red-suit">
          <div class="card-corner"><div class="card-rank">4</div><div class="card-suit-sm">‚ô•</div></div>
          <div class="card-center-suit">‚ô•</div>
          <div class="card-corner flip"><div class="card-rank">4</div><div class="card-suit-sm">‚ô•</div></div>
        </div>
      </div>

      <div class="post-right" id="postRight">
        <div class="card post-card black-suit">
          <div class="card-corner"><div class="card-rank">J</div><div class="card-suit-sm">‚ô†</div></div>
          <div class="card-center-suit">‚ô†</div>
          <div class="card-corner flip"><div class="card-rank">J</div><div class="card-suit-sm">‚ô†</div></div>
        </div>
      </div>

      <!-- THE DRAGGABLE CARD -->
      <div class="ball-wrap" id="ballWrap">
        <div class="ball-hint" id="ballHint">
          <div class="ball-hint-arrow">‚Üë</div>
          <div class="ball-hint-text">‰∏äÂàíÂèëÁâå</div>
        </div>
        <div class="drag-dir-label" id="dragDirLabel"></div>
        <div id="ballCardWrap" style="position:relative;">
          <div class="card ball-card face-down" id="ballCard">
            <div class="q-mark">?</div>
          </div>
        </div>
      </div>

    </div><!-- /goalpost-scene -->

    <div class="pot-area">
      <div class="pot-left">
        <div class="pot-lbl">Â•ñÊ±† ¬∑ Total Pot</div>
        <div class="pot-value"><div class="pot-cur">$</div><div class="pot-num" id="potNumber">1,240</div></div>
        <div class="pot-sub">4 players ¬∑ 2 rounds left</div>
      </div>
      <div class="coin-stack">
        <div class="coin-top">ü™ô</div>
        <div class="coin-disc c1"></div><div class="coin-disc c2"></div>
        <div class="coin-disc c3"></div><div class="coin-disc c4"></div><div class="coin-disc c5"></div>
      </div>
    </div>
  </div><!-- /arena -->

  <div class="deal-section">
    <div class="deal-hint-txt">‚Äî or tap ‚Äî</div>
    <button class="deal-tap-btn" id="dealTapBtn" onclick="tapDeal()">ÂèëÁâå Deal</button>
  </div>

  <div class="result-banner" id="resultBanner">
    <div class="banner-inner">
      <div class="banner-left">
        <div class="banner-emoji" id="bEmoji"></div>
        <div class="banner-title" id="bTitle"></div>
        <div class="banner-sub"   id="bSub"></div>
      </div>
      <div class="banner-right">
        <div class="banner-amt-lbl" id="bAmtLbl"></div>
        <div class="banner-amt-val" id="bAmtVal"></div>
      </div>
    </div>
    <button class="next-btn" onclick="resetGame()">‰∏ã‰∏ÄÂõûÂêà Next Round ‚Üí</button>
  </div>

</div><!-- /game-bg -->
</div><!-- /screen -->

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Config
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DRAG_LIMIT    = 38;   // hard px cap (~1 cm on 96dpi screens, feels right on mobile)
const FIRE_RATIO    = 0.55; // release above this fraction of DRAG_LIMIT = fire
const H_DEAD        = 12;   // px horizontal before lateral direction kicks in

const CARD_DATA = {
  goal:    [{rank:'7',suit:'‚ô¶',red:true},{rank:'8',suit:'‚ô£',red:false},{rank:'9',suit:'‚ô•',red:true}],
  'miss-l':[{rank:'2',suit:'‚ô£',red:false},{rank:'3',suit:'‚ô¶',red:true}],
  'miss-r':[{rank:'K',suit:'‚ô•',red:true},{rank:'A',suit:'‚ô†',red:false}],
  'post-l':[{rank:'4',suit:'‚ô£',red:false},{rank:'4',suit:'‚ô¶',red:true}],
  'post-r':[{rank:'J',suit:'‚ô•',red:true},{rank:'J',suit:'‚ô¶',red:true}],
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// State
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let mode      = 'goal';
let isDealing = false;
let dragging  = false;
let startX=0, startY=0, latestDY=0, latestDX=0;

const ballWrap     = document.getElementById('ballWrap');
const ballCard     = document.getElementById('ballCard');
const ballCardWrap = document.getElementById('ballCardWrap');
const ballHint     = document.getElementById('ballHint');
const dirLabel     = document.getElementById('dragDirLabel');
const screenEl     = document.getElementById('screenEl');

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Mode selector
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setMode(m) {
  mode = m;
  document.querySelectorAll('.demo-btn').forEach(b => b.className='demo-btn');
  document.getElementById('btn-'+m).classList.add('sel');
}
setMode('goal');

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Drag ‚Äî applied directly to ballWrap transform
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onStart(cx, cy) {
  if (isDealing) return;
  dragging = true;
  startX = cx; startY = cy;
  latestDY = 0; latestDX = 0;
  ballCard.classList.add('no-bob');
  ballHint.style.opacity = '0';
  dirLabel.className = 'drag-dir-label';
}

function onMove(cx, cy) {
  if (!dragging) return;

  const rawDY = startY - cy;  // positive = finger moved up
  const rawDX = cx - startX;  // positive = finger moved right

  // Only upward movement; apply rubber-band resistance approaching DRAG_LIMIT
  // sin easing: feels springy, hard-stops at limit
  const upRaw   = Math.max(0, rawDY);
  const upClamped = upRaw >= DRAG_LIMIT
    ? DRAG_LIMIT
    : DRAG_LIMIT * Math.sin((upRaw / DRAG_LIMIT) * (Math.PI / 2));

  // No horizontal movement during drag ‚Äî purely vertical
  latestDY = upClamped;
  latestDX = rawDX; // still tracked so arc knows which way to curve on release

  // Apply ‚Äî purely vertical, no lean
  setWrapTransform(0, -upClamped, 0, 1);

  // Direction label
  const ratio = upClamped / DRAG_LIMIT;
  if (ratio > 0.18) {
    dirLabel.className='drag-dir-label show d-up';
    dirLabel.textContent='‚Üë ‰∏äÂàíÂèëÁâå';
  } else {
    dirLabel.className = 'drag-dir-label';
  }
}

function onEnd() {
  if (!dragging) return;
  dragging = false;
  dirLabel.className = 'drag-dir-label';

  const ratio = latestDY / DRAG_LIMIT;

  if (ratio >= FIRE_RATIO) {
    // Fired ‚Äî launch the card from its current position
    launch(latestDY, latestDX);
  } else {
    // Snap back with spring
    ballWrap.style.transition = 'transform 0.38s cubic-bezier(0.34,1.56,0.64,1)';
    setWrapTransform(0, 0, 0, 1);
    setTimeout(() => {
      ballWrap.style.transition = '';
      ballCard.classList.remove('no-bob');
      ballHint.style.opacity = '1';
    }, 400);
  }
}

// Apply transform to ballWrap using its CSS baseline (translateX(-50%))
function setWrapTransform(leanX, offsetY, rotDeg, scale) {
  ballWrap.style.transform =
    `translateX(calc(-50% + ${leanX}px)) translateY(${offsetY}px) rotate(${rotDeg}deg) scale(${scale})`;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Touch & Mouse events on the card itself
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
ballWrap.addEventListener('touchstart', e => {
  e.preventDefault();
  onStart(e.touches[0].clientX, e.touches[0].clientY);
}, { passive:false });

ballWrap.addEventListener('touchmove', e => {
  e.preventDefault();
  onMove(e.touches[0].clientX, e.touches[0].clientY);
}, { passive:false });

ballWrap.addEventListener('touchend', e => {
  e.preventDefault();
  onEnd();
}, { passive:false });

ballWrap.addEventListener('mousedown', e => {
  e.preventDefault();
  onStart(e.clientX, e.clientY);
  const mm = ev => onMove(ev.clientX, ev.clientY);
  const mu = ()  => { onEnd(); window.removeEventListener('mousemove',mm); window.removeEventListener('mouseup',mu); };
  window.addEventListener('mousemove', mm);
  window.addEventListener('mouseup',   mu);
});

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Launch ‚Äî bezier arc driven by rAF
// Card is teleported to screenEl so game-bg overflow:hidden doesn't clip it.
// Flip happens at t=0.25 of the arc.
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function launch(releaseDY, releaseDX) {
  isDealing = true;
  document.getElementById('dealTapBtn').disabled = true;
  ballHint.style.opacity = '0';

  // Pick the card for this round
  const pool = CARD_DATA[mode];
  const card = pool[Math.floor(Math.random() * pool.length)];

  // --- Teleport ballWrap from inside game-bg (overflow:hidden) to screenEl (overflow:visible)
  // so the flying arc is never clipped
  const wRect = ballWrap.getBoundingClientRect();
  const sRect = screenEl.getBoundingClientRect();
  const startLeft = wRect.left - sRect.left;
  const startTop  = wRect.top  - sRect.top;

  // Switch to absolute positioning relative to screenEl
  ballWrap.style.position  = 'absolute';
  ballWrap.style.bottom    = 'auto';
  ballWrap.style.left      = startLeft + 'px';
  ballWrap.style.top       = startTop  + 'px';
  // The card is currently pulled up by releaseDY ‚Äî no lean
  ballWrap.style.transform = `translateY(${-releaseDY}px)`;
  screenEl.appendChild(ballWrap);

  // --- Define bezier control points relative to the TELEPORTED position (0,0)
  // Start:  (0, 0) ‚Äî where card sits right after teleport (already pulled up by releaseDY in transform)
  // We'll animate offsetX,offsetY on top of the base transform

  // Destination per outcome
  // Y: negative = up (away from bottom of screen)
  const outcomes = {
    goal:    { ex:   0, ey:-210, spin: -12 },
    'miss-l':{ ex:-220, ey: -70, spin: -50 },
    'miss-r':{ ex: 220, ey: -70, spin:  50 },
    'post-l':{ ex:-120, ey: -55, spin: -18, bounce:true },
    'post-r':{ ex: 120, ey: -55, spin:  18, bounce:true },
  };
  const dest = outcomes[mode];

  // Bezier control point ‚Äî card always rises through a peak before curving to dest
  // For goal: straight up peak. For miss: peak is above+slightly toward destination.
  const cpx = dest.ex * 0.3;  // control point pulls toward dest direction
  const cpy = -190;            // always arcs UP through ~190px above start

  const DUR = dest.bounce ? 750 : 1000; // ms
  const t0  = performance.now();

  // Start flash + whoosh immediately
  if (mode === 'goal') {
    triggerFlash('win','flash-gold 0.8s ease-out forwards');
    const wt = document.getElementById('whooshTrail');
    wt.classList.add('show'); setTimeout(()=>wt.classList.remove('show'),600);
  } else if (mode === 'post-l' || mode === 'post-r') {
    // flash on impact (at t~0.45), trigger later
  } else {
    triggerFlash('lose','flash-red 0.65s ease-out forwards');
  }

  // Flip card face-up at 25% of journey
  let flipped = false;

  function easeOut(t)    { return 1 - Math.pow(1-t, 3); }
  function easeInOut(t)  { return t<0.5 ? 4*t*t*t : 1-Math.pow(-2*t+2,3)/2; }

  // Quadratic bezier interpolation
  function bezier(t, p0, p1, p2) {
    const mt = 1-t;
    return mt*mt*p0 + 2*mt*t*p1 + t*t*p2;
  }

  if (dest.bounce) {
    // POST HIT: arc to post, then spring back
    const HALF = DUR * 0.45;

    (function tick(now) {
      const raw = Math.min((now-t0)/HALF, 1);
      const p   = easeOut(raw);

      const ox = bezier(raw, 0, cpx, dest.ex);
      const oy = bezier(raw, -releaseDY, -releaseDY + cpy, -releaseDY + dest.ey);
      const r  = dest.spin * p;
      ballWrap.style.transform = `translateX(${ox}px) translateY(${oy}px) rotate(${r}deg)`;

      if (!flipped && raw > 0.25) {
        flipped = true;
        flipCard(card);
      }

      if (raw < 1) { requestAnimationFrame(tick); return; }

      // Impact!
      triggerFlash('post','flash-gold 0.6s ease-out forwards');
      const postId = mode==='post-l' ? 'postLeft' : 'postRight';
      const postEl = document.getElementById(postId);
      postEl.classList.add('jolting');
      setTimeout(()=>postEl.classList.remove('jolting'), 450);

      // Spring back
      const snapStart = performance.now();
      const snapDur   = DUR * 0.55;
      const fromOX = dest.ex, fromOY = -releaseDY + dest.ey, fromR = dest.spin;

      (function snapTick(now2) {
        const s = Math.min((now2-snapStart)/snapDur, 1);
        const sp = easeOut(s);
        ballWrap.style.transform =
          `translateX(${fromOX*(1-sp)}px) translateY(${(fromOY)*(1-sp) + (-releaseDY)*sp * 0}px) rotate(${fromR*(1-sp)}deg)`;
        // Snap back to roughly where it launched from (y=‚àíreleaseDY)
        const curOX = fromOX * (1-sp);
        const curOY = fromOY + (-releaseDY - fromOY) * sp;
        ballWrap.style.transform = `translateX(${curOX}px) translateY(${curOY}px) rotate(${fromR*(1-sp)}deg)`;
        if (s < 1) { requestAnimationFrame(snapTick); return; }
        // Settle
        spawnPulseRing(ballCardWrap,'ring-post');
        spawnStamp(ballCardWrap,'stamp-post','üèπ ÊâìÊü±!');
        setTimeout(()=>showBanner('post',card), 700);
      })(snapStart);
    })(t0);

  } else {
    // GOAL / MISS: single smooth arc
    (function tick(now) {
      const raw = Math.min((now-t0)/DUR, 1);

      const ox = bezier(raw, 0, cpx, dest.ex);
      const oy = bezier(raw, -releaseDY, -releaseDY + cpy, -releaseDY + dest.ey);
      const r  = dest.spin * easeInOut(raw);
      const s  = 1 - 0.14 * easeOut(raw);  // slight shrink as it flies away

      ballWrap.style.transform = `translateX(${ox}px) translateY(${oy}px) rotate(${r}deg) scale(${s})`;

      // Flip at 25% of journey
      if (!flipped && raw > 0.25) {
        flipped = true;
        flipCard(card);
      }

      if (raw < 1) { requestAnimationFrame(tick); return; }

      // Arrived
      onArrival(mode, card);
    })(t0);
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Flip the card face-up in place (no position change)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function flipCard(card) {
  ballCard.style.transition = 'transform 0.15s ease-in';
  ballCard.style.transform  = 'rotateY(90deg)';
  setTimeout(() => {
    ballCard.className = `card ball-card no-bob ${card.red?'red-suit':'black-suit'}`;
    ballCard.style.transition = 'transform 0.15s ease-out';
    ballCard.style.transform  = 'rotateY(0deg)';
    ballCard.innerHTML = `
      <div class="card-corner"><div class="card-rank">${card.rank}</div><div class="card-suit-sm">${card.suit}</div></div>
      <div class="card-center-suit">${card.suit}</div>
      <div class="card-corner flip"><div class="card-rank">${card.rank}</div><div class="card-suit-sm">${card.suit}</div></div>`;
    setTimeout(()=>{ ballCard.style.transition=''; ballCard.style.transform=''; }, 160);
  }, 150);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Arrival effects
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function onArrival(outcome, card) {
  if (outcome === 'goal') {
    const svg = document.getElementById('crossbarSvg');
    svg.classList.add('net-rippling'); setTimeout(()=>svg.classList.remove('net-rippling'),750);
    ['postLeft','postRight'].forEach(id=>{
      const el=document.getElementById(id); el.classList.add('rattling'); setTimeout(()=>el.classList.remove('rattling'),560);
    });
    spawnPulseRing(ballCardWrap,'ring-win');
    spawnStamp(ballCardWrap,'stamp-win','üéâ IN BETWEEN!');
    spawnCoins(ballCardWrap, 14);
    spawnConfetti(document.getElementById('gameBg'));
    tickPot(1240,1620,800);
    setTimeout(()=>showBanner('win',card), 850);
  } else {
    // miss-l or miss-r
    spawnPulseRing(ballCardWrap,'ring-lose');
    spawnStamp(ballCardWrap,'stamp-miss', outcome==='miss-l' ? '‚óÄ Â§™Â∞è‰∫Ü!' : 'Â§™Â§ß‰∫Ü! ‚ñ∂');
    setTimeout(()=>showBanner('miss',card, outcome==='miss-l'?'smaller':'bigger'), 700);
  }
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Tap fallback
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function tapDeal() {
  if (isDealing) return;
  // Simulate a full drag
  onStart(0,0);
  latestDY = DRAG_LIMIT;
  latestDX = 0;
  dragging = true;
  onEnd();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Helpers
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function triggerFlash(type, anim) {
  const f=document.getElementById('flashOverlay');
  f.className=`flash-overlay ${type}`; f.style.animation=anim;
  setTimeout(()=>{ f.style.animation=''; f.className='flash-overlay'; },950);
}
function spawnStamp(wrap,cls,text) {
  const s=document.createElement('div'); s.className=`result-stamp ${cls}`; s.textContent=text; s.style.display='block'; wrap.appendChild(s);
}
function spawnPulseRing(wrap,cls) {
  const r=document.createElement('div'); r.className=`pulse-ring ${cls}`; wrap.appendChild(r); setTimeout(()=>r.remove(),900);
}
function spawnCoins(wrap,n) {
  const em=['ü™ô','‚ú®','üí∞','‚≠ê','ü™ô'];
  for(let i=0;i<n;i++){
    const c=document.createElement('div'); c.className='coin-particle'; c.textContent=em[i%em.length];
    const a=(i/n)*360, d=60+Math.random()*55;
    c.style.cssText=`--cx:${Math.cos(a*Math.PI/180)*d}px;--cy:${Math.sin(a*Math.PI/180)*d}px;animation-delay:${i*0.04}s;`;
    wrap.appendChild(c); setTimeout(()=>c.remove(),1400);
  }
}
function spawnConfetti(parent) {
  const cols=['#ffd700','#cc1a00','#ff3300','#ffe566','#fff','#f0b000'];
  for(let i=0;i<28;i++){
    const c=document.createElement('div'); c.className='confetti-piece';
    c.style.cssText=`background:${cols[i%cols.length]};left:${6+Math.random()*88}%;top:20%;animation-delay:${Math.random()*0.4}s;animation-duration:${0.8+Math.random()*0.55}s;transform:rotate(${Math.random()*360}deg);border-radius:${Math.random()>.5?'50%':'2px'};`;
    parent.appendChild(c); setTimeout(()=>c.remove(),1800);
  }
}
function tickPot(from,to,dur) {
  const el=document.getElementById('potNumber'), t0=performance.now();
  (function step(now){ const p=Math.min((now-t0)/dur,1); el.textContent=Math.round(from+(to-from)*(1-Math.pow(1-p,3))).toLocaleString(); if(p<1)requestAnimationFrame(step); })(t0);
}
function showBanner(type,card,dir) {
  const b=document.getElementById('resultBanner');
  const cfgs={
    win:  {cls:'b-win', emoji:'üéâ',title:'Ëøõ‰∫Ü! IN BETWEEN!', sub:`${card.rank}${card.suit} Â∞ÑÂÖ•ÁêÉÈó® üî•`,lbl:'‰Ω†Ëµ¢‰∫Ü!',val:'+$380'},
    miss: {cls:'b-miss',emoji:'üò≠',title:dir==='smaller'?'‚óÄ Â§™Â∞è! Miss!':'Â§™Â§ß! Miss! ‚ñ∂',sub:dir==='smaller'?`${card.rank}${card.suit} ‰Ωé‰∫éËåÉÂõ¥ üí®`:`${card.rank}${card.suit} È´ò‰∫éËåÉÂõ¥ üí®`,lbl:'‰Ω†Ëæì‰∫Ü!',val:'-$100'},
    post: {cls:'b-post',emoji:'üò±',title:'ÊâìÊü±! Hit the Post!',sub:`${card.rank}${card.suit} ÊâìÂà∞Êü±Â≠êÂºπÂá∫ üèπ`,lbl:'‰Ω†Ëæì‰∫Ü!',val:'-$100'},
  };
  const c=cfgs[type];
  b.className=`result-banner ${c.cls}`;
  document.getElementById('bEmoji').textContent =c.emoji;
  document.getElementById('bTitle').textContent =c.title;
  document.getElementById('bSub').textContent   =c.sub;
  document.getElementById('bAmtLbl').textContent=c.lbl;
  document.getElementById('bAmtVal').textContent=c.val;
  b.style.display='block';
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Reset
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetGame() {
  isDealing=false; dragging=false;

  // Re-parent ballWrap back into goalpost scene
  const gp=document.getElementById('goalposts');
  if(ballWrap.parentElement!==gp) gp.appendChild(ballWrap);

  // Reset all inline styles on ballWrap
  ballWrap.removeAttribute('style');

  // Reset card
  ballCard.className='card ball-card face-down';
  ballCard.style.cssText='';
  ballCard.innerHTML='<div class="q-mark">?</div>';

  // Clear particles/stamps
  ballCardWrap.querySelectorAll('.result-stamp,.coin-particle,.pulse-ring').forEach(e=>e.remove());

  // Restore hint + dir label
  ballHint.style.opacity='1';
  dirLabel.className='drag-dir-label';

  // Reset posts / svg / whoosh
  ['postLeft','postRight'].forEach(id=>document.getElementById(id).classList.remove('rattling','jolting'));
  document.getElementById('crossbarSvg').classList.remove('net-rippling');
  document.getElementById('whooshTrail').classList.remove('show');

  // Reset banner, pot, tap btn
  document.getElementById('resultBanner').style.display='none';
  document.getElementById('potNumber').textContent='1,240';
  document.getElementById('dealTapBtn').disabled=false;
}
</script>
</body>
</html>
